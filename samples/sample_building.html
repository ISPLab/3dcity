<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.108/Build/Cesium/Cesium.js" defer></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.108/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    // Check if Cesium is loaded and retry if not
    function initCesium() {
      if (typeof Cesium === 'undefined') {
        // If Cesium is not yet defined, wait and try again
        setTimeout(initCesium, 100);
        return;
      }
      
      // Cesium is loaded, now we can use it
      Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIzNjYxMTIwYS03YTdiLTQzY2MtYTU4My03ZDcxMWQ5NGU1OTciLCJpZCI6MTQ4NTM4LCJpYXQiOjE2ODc0NDY4OTF9.FcxwaPOxnu1bOjdgn566NDjJxj391dUfiDTf2GJpCpw';

      const viewer = new Cesium.Viewer("cesiumContainer", {
        infoBox: false,
        selectionIndicator: false,
        shadows: true,
        shouldAnimate: true
      });
      
      // "Footprint Court (HDR Labs)" environment settings
      
      // Set tone mapping to Linear
      if (viewer.scene.postProcessStages) {
        viewer.scene.postProcessStages.fxaa.enabled = true;
      }
      
      // Exposure setting -2.05
      viewer.scene.exposure = -2.05;
      
      // Setup ambient and direct lighting
      viewer.scene.globe.enableLighting = false;
      
      // Setup ambient light (ambient intensity: 1.27, ambient color: #ffffff)
      viewer.scene.light = new Cesium.DirectionalLight({
        direction: new Cesium.Cartesian3(-0.5, -0.5, -1.0),
        color: new Cesium.Color(1.0, 1.0, 1.0, 1.0), // #ffffff white color
        intensity: 3.9 // Direct intensity: 3.9
      });
      
      // Set ambient light to simulate HDR environment
      if (viewer.scene.sphericalHarmonicCoefficients) {
        viewer.scene.sphericalHarmonicCoefficients = [
          new Cesium.Cartesian3(1.27, 1.27, 1.27), // Ambient intensity coefficient
          new Cesium.Cartesian3(0, 0, 0),
          new Cesium.Cartesian3(0, 0, 0),
          new Cesium.Cartesian3(0, 0, 0),
          new Cesium.Cartesian3(0, 0, 0),
          new Cesium.Cartesian3(0, 0, 0),
          new Cesium.Cartesian3(0, 0, 0),
          new Cesium.Cartesian3(0, 0, 0),
          new Cesium.Cartesian3(0, 0, 0)
        ];
      }
      
      // Apply image-based lighting settings
      if (viewer.scene.imageBasedLighting) {
        viewer.scene.imageBasedLighting.intensity = 1.27; // Set ambient intensity
      }

      function createModel(url, height) {
        viewer.entities.removeAll();

        // You can adjust these coordinates to place your buildings in a specific location
        const position = Cesium.Cartesian3.fromDegrees(
          37.97881463004466,  // longitude
          55.83593475851157,  // latitude
          height       // height
        );
        const heading = Cesium.Math.toRadians(135);
        const pitch = 0;
        const roll = 0;
        const hpr = new Cesium.HeadingPitchRoll(heading, pitch, roll);
        const orientation = Cesium.Transforms.headingPitchRollQuaternion(position, hpr);

        const entity = viewer.entities.add({
          name: "Sample Buildings",
          position: position,
          orientation: orientation,
          model: {
            uri: url,
            minimumPixelSize: 128,
            maximumScale: 20000,
            colorBlendMode: Cesium.ColorBlendMode ? Cesium.ColorBlendMode.HIGHLIGHT : 1,
            // Apply HDR Labs Footprint Court lighting to model
            imageBasedLightingFactor: new Cesium.Cartesian2(1.27, 1.0), // Ambient intensity
            luminanceAtZenith: 0.2,
           // lightColor: new Cesium.Cartesian3(3.9, 3.9, 3.9), // Direct intensity
          },
        });
        
        viewer.trackedEntity = entity;
        
        // Setup optimal viewing position
        setTimeout(function() {
          viewer.zoomTo(entity, new Cesium.HeadingPitchRange(
            Cesium.Math.toRadians(45),
            Cesium.Math.toRadians(-25),
            500
          ));
        }, 1000);
      }

      // Use local path for model
      const modelUrl = "./sample_buildings_2.glb";
      
      // Create model with zero height
      createModel(modelUrl, 0);
    }

    // Start the initialization process when page loads
    window.onload = initCesium;
  </script>
</body>
</html>